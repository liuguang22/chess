<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>车棋游戏</title>
    <link rel="stylesheet" href="styles.css">

    <!-- 引入 Element Plus 和 Vue3 CDN -->
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css" />
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://unpkg.com/element-plus/dist/index.full.js"></script>
</head>
<body>
    <h1>车棋游戏</h1>
    <p>规则: 您操控一个车(红色)，对方有多种象棋棋子。车可以横竖直线移动，需要避开对方棋子的攻击范围。每回合击杀一个棋子，游戏继续。特殊规则：车吃掉将后，下一步会消除该点所在行列的所有棋子。</p>

    <div class="game-status" id="gameStatus">游戏状态：拖拽棋子可以移动它们。移动后系统会自动计算车的最佳移动位置。</div>

    <div class="board" id="board"></div>

    <div class="mobile-controls" id="mobileControls">
        <p class="mobile-info">提示：在移动设备上，先点击棋子选中，再点击目标位置移动</p>
    </div>

    <div class="result-area" id="resultArea">
        <h3>车的最佳移动</h3>
        <p>当前无建议。请添加棋子后计算。</p>
    </div>

    <div class="button-group">
        <button class="btn" id="calculateMove">计算最佳移动</button>
        <button class="btn" id="resetBoard">重置棋盘</button>
    </div>

    <!-- 抽屉区域 -->
    <div id="pieceDrawerApp">
      <el-button class="btn" type="primary" @click="drawerVisible = true">添加棋子</el-button>

      <el-drawer
        v-model="drawerVisible"
        title="从下方拖动棋子到棋盘"
        direction="btt"
        size="auto"
        :with-header="true"
        append-to-body
      >
        <div class="piece-selection">
          <div
            class="selectable-piece piece"
            v-for="piece in pieces"
            :class="piece.type"
            :key="piece.type"
            :data-type="piece.type"
            draggable="true"
            @dragstart="handleDragStart"
          >
            {{ piece.label }}
          </div>
        </div>
      </el-drawer>
    </div>

    <script src="index.js"></script>

    <script>
    const { createApp, ref } = Vue;

    createApp({
      setup() {
        const drawerVisible = ref(false);
        const pieces = ref([
          { type: 'car', label: '车' },
          { type: 'knight', label: '马' },
          { type: 'cannon', label: '炮' },
          { type: 'bishop', label: '象' },
          { type: 'advisor', label: '士' },
          { type: 'pawn', label: '兵' },
          { type: 'king', label: '将' }
        ]);

        function handleDragStart(e) {
          const type = e.target.dataset.type;
          e.dataTransfer.setData('pieceType', type);
        }

        return { drawerVisible, pieces, handleDragStart };
      }
    }).use(ElementPlus).mount('#pieceDrawerApp');
    </script>
</body>
</html>
